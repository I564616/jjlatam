<!--<?xml version="1.0" encoding="UTF-8"?>-->
<!--&lt;!&ndash;-->
<!-- [y] hybris Platform-->

<!-- Copyright (c) 2018 SAP SE or an SAP affiliate company.  All rights reserved.-->

<!-- This software is the confidential and proprietary information of SAP-->
<!-- ("Confidential Information"). You shall not disclose such Confidential-->
<!-- Information and shall use it only in accordance with the terms of the-->
<!-- license agreement you entered into with SAP.-->
<!--&ndash;&gt;-->
<!--<beans xmlns="http://www.springframework.org/schema/beans" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"-->
<!--       xmlns:security="http://www.springframework.org/schema/security"-->
<!--       xsi:schemaLocation="http://www.springframework.org/schema/beans-->
<!--		http://www.springframework.org/schema/beans/spring-beans.xsd-->
<!--		http://www.springframework.org/schema/security -->
<!--		http://www.springframework.org/schema/security/spring-security.xsd">-->


<!--	&lt;!&ndash; Swagger resources &ndash;&gt;-->
<!--	<security:http pattern="/#{configurationService.configuration.getProperty('springfox.documentation.swagger.v2.path')}" security="none"/>-->
<!--	<security:http pattern="/*swagger*/**" security="none"/>-->

<!--	&lt;!&ndash; Commerce Webservices V2&ndash;&gt;-->
<!--	<http pattern="/v2/**" entry-point-ref="oauthAuthenticationEntryPointV2"-->
<!--	      access-decision-manager-ref="webSecurityAccessDecisionManager"-->
<!--	      xmlns="http://www.springframework.org/schema/security" create-session="stateless">-->

<!--		<anonymous username="anonymous" granted-authority="ROLE_ANONYMOUS"/>-->
<!--		&lt;!&ndash;<session-management session-authentication-strategy-ref="fixation"/>&ndash;&gt;-->

<!--		<intercept-url pattern="/**" requires-channel="https"/>-->

<!--		<port-mappings>-->
<!--			<port-mapping http="#{configurationService.configuration.getProperty('tomcat.http.port')}"-->
<!--			              https="#{configurationService.configuration.getProperty('tomcat.ssl.port')}"/>-->
<!--			<port-mapping http="#{configurationService.configuration.getProperty('embeddedserver.http.port')}" -->
<!--						  https="#{configurationService.configuration.getProperty('embeddedserver.ssl.port')}" />-->
<!--		</port-mappings>-->

<!--		<custom-filter ref="resourceServerFilter" before="PRE_AUTH_FILTER"/>-->
<!--		<access-denied-handler ref="oauthAccessDeniedHandlerV2"/>-->
<!--		-->
<!--		<headers >-->
<!--			<content-type-options />-->
<!--			<hsts include-subdomains="true" max-age-seconds="16070400" />-->
<!--			<xss-protection />-->
<!--			<security:frame-options disabled="true"/>-->
<!--		</headers>-->
<!--		<security:csrf disabled="true"/>-->
<!--	</http>-->

<!--	<bean id="oauthAuthenticationEntryPointV2" parent="oauthAuthenticationEntryPoint">-->
<!--		<property name="exceptionRenderer" ref="oAuth2ExceptionRendererV2"/>-->
<!--	</bean>-->

<!--	<bean id="oauthAccessDeniedHandlerV2" parent="oauthAccessDeniedHandler">-->
<!--		<property name="exceptionRenderer" ref="oAuth2ExceptionRendererV2"/>-->
<!--	</bean>-->

<!--	<bean id="oAuth2ExceptionRendererV2" parent="oAuth2ExceptionRenderer">-->
<!--		<property name="messageConverters" ref="messageConvertersV2"/>-->
<!--	</bean>-->
<!--</beans>-->

<?xml version="1.0" encoding="UTF-8"?>
<!--
 [y] hybris Platform

 Copyright (c) 2018 SAP SE
 All rights reserved.
-->
<beans xmlns="http://www.springframework.org/schema/beans"
       xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
       xmlns:security="http://www.springframework.org/schema/security"
       xsi:schemaLocation="
        http://www.springframework.org/schema/beans
        http://www.springframework.org/schema/beans/spring-beans.xsd
        http://www.springframework.org/schema/security
        http://www.springframework.org/schema/security/spring-security.xsd">

    <!-- Swagger resources -->
    <security:http pattern="/#{configurationService.configuration.getProperty('springfox.documentation.swagger.v2.path')}"
                   security="none"/>

    <security:http pattern="/*swagger*/**"
                   security="none"/>

    <!-- Commerce Webservices V2 â€“ New OAuth2 / JWT Based -->
    <security:http pattern="/v2/**"
                   use-authorization-manager="true"
                   use-expressions="true"
                   create-session="stateless">

        <security:anonymous username="anonymous" granted-authority="ROLE_ANONYMOUS"/>

        <!-- Enforce HTTPS -->
        <security:intercept-url pattern="/**" requires-channel="https" access="permitAll"/>

        <!-- Port mappings -->
        <security:port-mappings>
            <security:port-mapping
                    http="#{configurationService.configuration.getProperty('tomcat.http.port')}"
                    https="#{configurationService.configuration.getProperty('tomcat.ssl.port')}"/>
            <security:port-mapping
                    http="#{configurationService.configuration.getProperty('embeddedserver.http.port')}"
                    https="#{configurationService.configuration.getProperty('embeddedserver.ssl.port')}"/>
        </security:port-mappings>

        <!-- Replace old resourceServerFilter -->
        <security:custom-filter ref="jwtAuthenticationUserFilter" after="LAST" />

        <!-- Updated Headers -->
        <security:headers>
            <security:content-type-options />
            <security:hsts include-subdomains="true" max-age-seconds="16070400" />
            <security:xss-protection />
            <security:frame-options disabled="true"/>
        </security:headers>

        <security:csrf disabled="true"/>

        <!-- NEW OAuth2 Resource Server with JWT -->
        <security:oauth2-resource-server entry-point-ref="enrichingAuthenticationEntryPoint">
            <security:jwt decoder-ref="jwtDecoder"
                          jwt-authentication-converter-ref="jwtAuthenticationRoleConverter" />
        </security:oauth2-resource-server>

        <security:access-denied-handler ref="enrichingAccessDeniedHandler" />

    </security:http>

</beans>

